# ポモドーロタイマー 機能一覧

## 分類ポリシー

- フェーズ: `MVP`, `Phase2`, `Phase3+` で段階的導入
- 優先度: `High`, `Medium`, `Low`
- 受入条件(AC): 画面/動作/データ反映の具体条件

## MVP 機能 (必須)

| ID | 機能名 | 概要 | 優先度 | AC概要 |
|----|--------|------|--------|--------|
| MVP-1 | フォーカス開始 | 指定分数で集中セッション開始 | High | ボタン押下でAPI成功し残り時間がカウントダウン開始 |
| MVP-2 | 休憩開始 | 集中終了後または手動で休憩開始 | High | 休憩開始で残り休憩時間表示 |
| MVP-3 | セッション中断(停止) | 進行中セッションを強制終了 | High | 停止後 state が idle に戻る |
| MVP-4 | セッション状態取得 | 現在の mode / 残り秒数 / 統計を取得 | High | ページ再読込で正しい状態表示 |
| MVP-5 | 日次統計集計 | 完了フォーカス数と合計秒数を表示 | High | セッション完了後統計が即更新 |
| MVP-6 | 円形プログレスUI | 残り時間を円グラフで可視化 | High | カウントダウンに応じ円が減少 |
| MVP-7 | 時刻ズレ補正 | 再読込やPCスリープ後も残り時間補正 | High | planned_end_at から残り秒数再計算 |
| MVP-8 | セッション重複防止 | 進行中に再度開始要求を拒否 | High | 409エラーまたはUIでボタン非活性 |
| MVP-9 | バリデーション(時間) | duration範囲チェック (例1〜240分) | Medium | 不正入力時 400 返却 |
| MVP-10 | エラーハンドリングUI | API失敗時ユーザー通知 | Medium | トースト/メッセージ表示 |
| MVP-11 | 最低限ログ | 開始/終了/中断をサーバログ出力 | Medium | ログに event/開始ID/時刻記録 |
| MVP-12 | 設定ファイル/環境変数 | DB URI / SECRET_KEY 読込 | Medium | config.pyで環境切替可能 |
| MVP-13 | 初期テスト | servicesユニット + routes統合 | Medium | CIでテスト成功 |
| MVP-14 | アクセシビリティ基礎 | ボタンラベル/aria属性 | Low | キーボード操作可能 |

## Phase2 機能 (統計と快適性拡張)

| ID | 機能名 | 概要 | 優先度 | AC概要 |
|----|--------|------|--------|--------|
| P2-1 | 長休憩自動挿入 | 所定回数後に長休憩提示 | High | 4フォーカス完了後に15分休憩提案モーダル |
| P2-2 | 可変プリセット | 25/5, 50/10 など選択 | High | UIで選択し start 時適用 |
| P2-3 | 週間/月間統計 | 過去集計一覧 | High | 表示APIから7/30日データ取得 |
| P2-4 | WebSocket同期 | タブ間リアルタイム更新 | Medium | 他タブで状態変化を即反映 |
| P2-5 | デスクトップ通知 | フォーカス/休憩終了通知 | Medium | 許可後 OS 通知表示 |
| P2-6 | 軽量認証(シングルユーザー) | ローカルパスワード/セッション | Medium | ログイン後のみ履歴参照 |
| P2-7 | タグ(作業カテゴリ) | セッションにタグ付与 | Medium | 統計にタグ別集計 |
| P2-8 | UIテーマ切替 | ダーク/ライト | Low | トグルで即時反映 |
| P2-9 | i18n基盤 | 日本語/英語切替 | Low | 言語選択で表示更新 |

## Phase3+ 機能 (高度/拡張)

| ID | 機能名 | 概要 | 優先度 | AC概要 |
|----|--------|------|--------|--------|
| P3-1 | マルチユーザー認証 | Flask-Login + RBAC | High | ユーザー別データ分離 |
| P3-2 | OAuth連携 | Google等SSO | Medium | SSOでログイン成功 |
| P3-3 | Gamificationバッジ | 累積実績でバッジ付与 | Medium | 条件達成時に新規バッジ表示 |
| P3-4 | タスク連携 | 外部Issue管理と紐付け | Medium | セッションに外部タスクID保存 |
| P3-5 | 高度な分析 | 生産性グラフ/集中パターン | Medium | 可視化チャート描画 |
| P3-6 | モバイルPWA化 | オフライン/ホーム追加 | Medium | PWA manifest & offline cache |
| P3-7 | メトリクス/監視 | Prometheus/ Grafana | Low | /metrics で収集可能 |
| P3-8 | A/Bテスト基盤 | UI改善検証 | Low | バリアント別計測 |
| P3-9 | エクスポート/インポート | CSV/JSON出力/復元 | Low | ダウンロード/アップロード成功 |
| P3-10 | テスト自動化強化 | E2E/負荷テスト | Low | CIで自動実行結果可視化 |

## 詳細受入条件 (サンプル抜粋)

### MVP-1 フォーカス開始

- 入力: duration_minutes (省略時25)
- 前提: activeセッションが存在しない
- 成功: 201/200で JSON `{id, type='focus', planned_end_at}` を返す
- 失敗: 409 activeあり, 400 duration不正
- ログ: level=INFO, event=start_focus, session_id

### MVP-5 日次統計集計

- セッション完了トリガで DailyStat upsert
- GET /api/pomodoro/stats/daily で date指定 (未指定なら今日)
- 集計項目: completed_focus_count, total_focus_seconds
- 完了直後の表示更新最大遅延 < 2秒

### P2-4 WebSocket同期

- イベント: state_update, stats_update
- 他タブで開始/終了操作時 <1秒で反映

## 非機能関連機能

| ID | 機能名 | 概要 | 優先度 | AC概要 |
|----|--------|------|--------|--------|
| NF-1 | 構成管理 | .env 読込/本番設定分離 | High | ENV切替でDB/SECRET変更 |
| NF-2 | ロギング基盤 | JSON構造ログ | Medium | 主要イベントが一行JSON |
| NF-3 | エラートラッキング | Sentry等統合 | Low | 例外発生時送信 |
| NF-4 | CIセットアップ | GitHub Actions | High | push時テスト/lint成功 |
| NF-5 | セキュリティヘッダ | 基本的なヘッダ追加 | Medium | X-Frame-Optionsなど付与 |
| NF-6 | パフォーマンス監視 | レスポンスタイム測定 | Low | 中央値/95%タイル表示 |

## リスク / 未確定事項

- 認証方式: MVPでは不要、Phase2以降で要件再確認
- タグ分類粒度: UI複雑化懸念
- リアルタイム方式選択: SocketIO vs SSE (同時接続数とホスティング条件次第)
- PWAキャッシュ戦略: オフライン時にどこまで機能許容するか

## 今後の優先実装 (MVP着手順)

1. MVP-1,3,4 (開始/停止/状態取得) 基盤
2. MVP-5 (統計) & MVP-8 (重複防止)
3. MVP-6 (円形UI) & MVP-7 (ズレ補正)
4. バリデーション/ログ/テスト (MVP-9,11,13)
5. 残りのMedium/Low (順次)

---

必要に応じてこの `features.md` を更新し、Issue/タスク化してください。
